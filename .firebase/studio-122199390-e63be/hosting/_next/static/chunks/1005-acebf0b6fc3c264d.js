"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1005],{1554:(e,t,r)=>{r.d(t,{R8:()=>c,As:()=>h,jt:()=>p});var a=r(5155),s=r(2115),o=r(2949),n=r(9891),i=r(5894);function u(){let{toast:e}=(0,i.dj)();return(0,s.useEffect)(()=>{let t=t=>{console.error(t),e({variant:"destructive",title:"Permission Error",description:"You do not have permission to perform this action. Check Firestore rules."})};return n.d.on("permission-error",t),()=>{n.d.off("permission-error",t)}},[e]),null}let d=(0,s.createContext)(null);function c(e){let{children:t}=e,[r,n]=(0,s.useState)({app:null,auth:null,db:null});(0,s.useEffect)(()=>{n({app:o.yA,auth:o.j2,db:o.db})},[]);let i=(0,s.useMemo)(()=>r,[r]);return(0,a.jsxs)(d.Provider,{value:i,children:[t,(0,a.jsx)(u,{})]})}let l=()=>{let e=(0,s.useContext)(d);if(!e)throw Error("useFirebase must be used within a FirebaseProvider");return e},p=()=>l().db,h=()=>l().auth},2298:(e,t,r)=>{r.d(t,{J:()=>o});var a=r(2115),s=r(1554);let o=()=>{let e=(0,s.As)(),[t,r]=(0,a.useState)((null==e?void 0:e.currentUser)||null),[o,n]=(0,a.useState)(!0);return(0,a.useEffect)(()=>{if(!e)return;let t=e.onAuthStateChanged(e=>{r(e),n(!1)});return()=>t()},[e]),{user:t,isLoading:o}}},2949:(e,t,r)=>{r.d(t,{yA:()=>m,j2:()=>f,db:()=>b,Ge:()=>p,uN:()=>h,Jd:()=>u.J});var a=r(2078),s=r(3885),o=r(9708),n=r(8134),i=r(1554),u=r(2298),d=r(2115),c=r(9891),l=r(6501);function p(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{listen:!1},a=(0,i.jt)(),[s,n]=(0,d.useState)(null),[u,p]=(0,d.useState)(!0);return(0,d.useEffect)(()=>{let r;if(!a)return void p(!1);if(t&&(void 0===t[2]||null===t[2])){n([]),p(!1);return}r=t?(0,o.P)((0,o.rJ)(a,e),(0,o._M)(t[0],t[1],t[2])):(0,o.P)((0,o.rJ)(a,e));let s=(0,o.aQ)(r,e=>{n(e.docs.map(e=>({...e.data(),id:e.id}))),p(!1)},t=>{console.error("Error fetching collection: ".concat(e),t);let r=new l.$({path:e,operation:"list"});c.d.emit("permission-error",r),p(!1)});return()=>s()},[a,e,r.listen,...t||[]]),{data:s,isLoading:u}}function h(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{listen:!1},a=(0,i.jt)(),[s,n]=(0,d.useState)(null),[u,p]=(0,d.useState)(!0);return(0,d.useEffect)(()=>{if(!a||!t){n(null),p(!1);return}let r=(0,o.H9)(a,e,t),s=(0,o.aQ)(r,e=>{e.exists()?n({...e.data(),id:e.id}):n(null),p(!1)},e=>{console.error("Error fetching document:",e);let t=new l.$({path:r.path,operation:"get"});c.d.emit("permission-error",t),p(!1)});return()=>s()},[a,e,t,r.listen]),{data:s,isLoading:u}}let m=(0,a.Dk)().length?(0,a.Sx)():(0,a.Wp)({apiKey:"AIzaSyXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX",authDomain:"your-project-id.firebaseapp.com",projectId:"your-project-id",storageBucket:"your-project-id.appspot.com",messagingSenderId:"your-sender-id",appId:"1:your-sender-id:web:your-app-id"}),f=(0,s.xI)(m),b=(0,o.aU)(m);(0,n.c7)(m)},3998:(e,t,r)=>{r.d(t,{$:()=>d});var a=r(5155),s=r(2115),o=r(7129),n=r(3101),i=r(4269);let u=(0,n.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),d=s.forwardRef((e,t)=>{let{className:r,variant:s,size:n,asChild:d=!1,...c}=e,l=d?o.DX:"button";return(0,a.jsx)(l,{className:(0,i.cn)(u({variant:s,size:n,className:r})),ref:t,...c})});d.displayName="Button"},5894:(e,t,r)=>{r.d(t,{dj:()=>l});var a=r(2115);let s=0,o=new Map,n=e=>{if(o.has(e))return;let t=setTimeout(()=>{o.delete(e),d({type:"REMOVE_TOAST",toastId:e})},1e6);o.set(e,t)},i=[],u={toasts:[]};function d(e){u=((e,t)=>{switch(t.type){case"ADD_TOAST":return{...e,toasts:[t.toast,...e.toasts].slice(0,1)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(e=>e.id===t.toast.id?{...e,...t.toast}:e)};case"DISMISS_TOAST":{let{toastId:r}=t;return r?n(r):e.toasts.forEach(e=>{n(e.id)}),{...e,toasts:e.toasts.map(e=>e.id===r||void 0===r?{...e,open:!1}:e)}}case"REMOVE_TOAST":if(void 0===t.toastId)return{...e,toasts:[]};return{...e,toasts:e.toasts.filter(e=>e.id!==t.toastId)}}})(u,e),i.forEach(e=>{e(u)})}function c(e){let{...t}=e,r=(s=(s+1)%Number.MAX_SAFE_INTEGER).toString(),a=()=>d({type:"DISMISS_TOAST",toastId:r});return d({type:"ADD_TOAST",toast:{...t,id:r,open:!0,onOpenChange:e=>{e||a()}}}),{id:r,dismiss:a,update:e=>d({type:"UPDATE_TOAST",toast:{...e,id:r}})}}function l(){let[e,t]=a.useState(u);return a.useEffect(()=>(i.push(t),()=>{let e=i.indexOf(t);e>-1&&i.splice(e,1)}),[e]),{...e,toast:c,dismiss:e=>d({type:"DISMISS_TOAST",toastId:e})}}},6501:(e,t,r)=>{r.d(t,{$:()=>a});class a extends Error{constructor(e){super("FirestoreError: Missing or insufficient permissions: The following request was denied by Firestore Security Rules:\n".concat(JSON.stringify(e,null,2))),this.name="FirestorePermissionError",this.context=e}}},8058:(e,t,r)=>{r.d(t,{BE:()=>X,I:()=>T,K1:()=>v,M7:()=>y,Mj:()=>I,OQ:()=>f,R$:()=>P,U1:()=>E,ZZ:()=>R,_m:()=>h,bB:()=>x,ec:()=>w,f2:()=>$,fn:()=>_,hN:()=>g,on:()=>S,qA:()=>A,r$:()=>b,v1:()=>D,x2:()=>p,z0:()=>m});var a=r(2949),s=r(9708);r(3870);var o=r(9891),n=r(6501);let i=(0,s.rJ)(a.db,"accounts"),u=(0,s.rJ)(a.db,"exchangeRequests"),d=(0,s.rJ)(a.db,"goldCoinPurchases"),c=(0,s.rJ)(a.db,"races"),l=(0,s.rJ)(a.db,"riders"),p=async e=>{let t=(0,s.P)(i,(0,s._M)("email","==",e)),r=await (0,s.GG)(t);if(!r.empty){let e=r.docs[0];return{id:e.id,...e.data()}}return null},h=(e,t)=>{let r=(0,s.H9)(a.db,"accounts",e),i={...t,isAdmin:!1};(0,s.BN)(r,i).catch(async e=>{let t=new n.$({path:r.path,operation:"create",requestResourceData:i});o.d.emit("permission-error",t)})},m=(e,t)=>{let r=(0,s.H9)(a.db,"accounts",e);(0,s.mZ)(r,t).catch(async e=>{let a=new n.$({path:r.path,operation:"update",requestResourceData:t});o.d.emit("permission-error",a)})},f=async e=>{let t=(0,s.P)(i,(0,s._M)("username","==",e));return!(await (0,s.GG)(t)).empty},b=async(e,t)=>{let r=(0,s.P)(i,(0,s._M)("riderNumber","==",e)),a=await (0,s.GG)(r);return!a.empty&&(!t||a.docs.some(e=>e.id!==t))},y=async e=>{if(!e||0===e.length)return[];let t=[];for(let r=0;r<e.length;r+=30){let a=e.slice(r,r+30),o=(0,s.P)(i,(0,s._M)("__name__","in",a));(await (0,s.GG)(o)).forEach(e=>{t.push({id:e.id,...e.data()})})}return t.sort((e,t)=>e.name.localeCompare(t.name))},g=async e=>{let t=(0,s.P)(i,(0,s._M)("username","==",e)),r=await (0,s.GG)(t);if(!r.empty){let e=r.docs[0];return{id:e.id,...e.data()}}return null},w=async()=>(await (0,s.GG)(u)).docs.map(e=>({id:e.id,...e.data()})),v=async e=>{try{return(await (0,s.gS)(u,e)).id}catch(r){let t=new n.$({path:u.path,operation:"create",requestResourceData:e});throw o.d.emit("permission-error",t),r}},S=async(e,t)=>{let r=(0,s.wP)(a.db),i=(0,s.H9)(a.db,"exchangeRequests",e.id);if(r.update(i,{status:t}),"Rejected"===t){let t=(0,s.H9)(a.db,"accounts",e.accountId),o=await (0,s.x7)(t);if(o.exists()){let a=o.data(),s=a.balances.gold,n=a.balances.sweeps;"Gold Coin"===e.type?s+=e.amount:"Sweeps Coin"===e.type&&(n+=e.amount),r.update(t,{balances:{gold:s,sweeps:n}})}else throw Error("Account with ID ".concat(e.accountId," not found."))}try{await r.commit()}catch(a){let r=new n.$({path:"/exchangeRequests/".concat(e.id),operation:"update",requestResourceData:{status:t}});throw o.d.emit("permission-error",r),a}},E=async e=>{try{return(await (0,s.gS)(d,e)).id}catch(r){let t=new n.$({path:d.path,operation:"create",requestResourceData:e});throw o.d.emit("permission-error",t),r}},X=(e,t)=>{let r=(0,s.H9)(a.db,"goldCoinPurchases",e);(0,s.mZ)(r,t).catch(async e=>{let a=new n.$({path:r.path,operation:"update",requestResourceData:t});o.d.emit("permission-error",a)})},x=async(e,t)=>{let r=(0,s.wP)(a.db),i=(0,s.H9)(a.db,"goldCoinPurchases",e.id);if("Refunded"===t){let o=(0,s.H9)(a.db,"accounts",e.userId),n=await (0,s.x7)(o);if(n.exists()){let a=n.data();if(a.balances.gold>=e.amount)r.update(o,{"balances.gold":a.balances.gold-e.amount}),r.update(i,{status:t});else throw Error("Insufficient balance to process refund.")}else throw Error("Account with ID ".concat(e.userId," not found."))}else r.update(i,{status:t});try{await r.commit()}catch(r){let e=new n.$({path:i.path,operation:"update",requestResourceData:{status:t}});throw o.d.emit("permission-error",e),r}},_=e=>{(0,s.gS)(c,e).catch(async t=>{let r=new n.$({path:c.path,operation:"create",requestResourceData:e});o.d.emit("permission-error",r)})},D=(e,t)=>{let r=(0,s.H9)(a.db,"races",e);(0,s.mZ)(r,t).catch(async e=>{let a=new n.$({path:r.path,operation:"update",requestResourceData:t});o.d.emit("permission-error",a)})},R=e=>{let t=(0,s.H9)(a.db,"races",e);(0,s.kd)(t).catch(async e=>{let r=new n.$({path:t.path,operation:"delete"});o.d.emit("permission-error",r)})},A=e=>{(0,s.gS)(l,e).catch(async t=>{let r=new n.$({path:l.path,operation:"create",requestResourceData:e});o.d.emit("permission-error",r)})},I=(e,t)=>{let r=(0,s.H9)(a.db,"riders",e);(0,s.mZ)(r,t).catch(async e=>{let a=new n.$({path:r.path,operation:"update",requestResourceData:t});o.d.emit("permission-error",a)})},T=e=>{let t=(0,s.H9)(a.db,"riders",e);(0,s.kd)(t).catch(async e=>{let r=new n.$({path:t.path,operation:"delete"});o.d.emit("permission-error",r)})},$=async e=>{let t=(0,s.H9)(a.db,"raceResults",e);try{let e=await (0,s.x7)(t);if(e.exists())return{id:e.id,...e.data()};return null}catch(r){let e=new n.$({path:t.path,operation:"get"});return o.d.emit("permission-error",e),null}},P=(e,t)=>{let r=(0,s.H9)(a.db,"raceResults",e);(0,s.BN)(r,t).catch(async e=>{let a=new n.$({path:r.path,operation:"create",requestResourceData:t});o.d.emit("permission-error",a)})}},9891:(e,t,r)=>{r.d(t,{d:()=>a});let a=new(r(6459)).EventEmitter}}]);